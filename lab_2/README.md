# TSU_operating_systems

## Лабораторная работа Безопасная обработка сетевых подключений и сигналов»

Требуется подготовить безопасную  реализацию серверного процесса, который совмещает обработку соединений TCP/IP  с обработкой сигналов        (можно выбрать, скажем, сигнал `SIGHUP`).  Приложение должно:

1. Принимать соединения на некоторый порт, сообщать о новых  соединениях на терминал, одно соединение оставлять принятым, остальные  закрывать сразу после подключения.
2. При появлении любых данных в соединении выводить сообщение  на терминал (для простоты достаточно вывести только количество  полученных данных).
3. При получении сигнала выводить сообщение на терминал.  Фактически, работа сводится к правильному вызову функции `pselect()`, но все действия должны быть выполнены в предельно безопасном виде,  исключающем любые race condition.



## Полезная информация:

### Стуруктуры данных:

#### 1. fd_set

Это структура данных, предоставляемая библиотекой Sockets, для работы с множеством файловых дескрипторов. В данном случае, `readfds` будет использоваться для хранения  множества файловых дескрипторов, которые нужно мониторить на наличие  данных для чтения. Это важно для асинхронного мультиплексирования, когда вы хотите одновременно обслуживать несколько соединений без блокировки.

#### 2. pthread_mutex_t

Мьютекс представляет собой примитив синхронизации, который блокирует  доступ к общим ресурсам одному потоку, пока другой поток не освободит  мьютекс. В данном случае, он может быть использован для обеспечения  безопасности доступа к общим данным, таким как множество `readfds` или другие структуры данных, при работе с разными потоками.

#### 3. struct sockaddr_in 

Это объявление структуры `sockaddr_in`, которая используется  для хранения информации о сетевом адресе. В частности, эта структура  используется для представления IP-адресов и номеров портов для сетевых  соединений.

#### 4. pthread_t

Переменная `pthread_t` используется для хранения  идентификатора потока (thread) в POSIX-совместимых системах. Потоки  позволяют выполнять параллельные задачи внутри процесса. В данном  случае, `thread_id` предполагает, что будет использоваться многозадачность для обработки сетевых соединений.

### Макросы:

`AF_INET`: Это семейство протоколов, которое указывает, что сокет будет использовать IP-протокол IPv4.

`SOCK_STREAM`: Это тип сокета, который обозначает сокет для  потоковой передачи данных, что означает, что данные будут передаваться в виде потоков байтов без сохранения границ сообщений.

`SIGHUP` - это макрос, представляющий номер сигнала SIGHUP.  SIGHUP обычно используется для сброса (перезапуска) процесса или для  указания процессу перечитать конфигурационные файлы. Он может быть  послан процессу, например, командой `kill -HUP <pid>`, где `<pid>` - идентификатор процесса.

### Функции:

`FD_ZERO(&readfds);` - Эта функция очищает (устанавливает в ноль) все биты в наборе `readfds`. Набор `readfds` представляет собой набор файловых дескрипторов, которые мы  мониторим на чтение.



`FD_SET(server_fd, &readfds);` - Эта функция устанавливает бит, соответствующий `server_fd`, в наборе `readfds`. Это означает, что после этой операции `server_fd` будет мониториться на чтение.



`int pselect(int nfds, fd_set *readfds, fd_set *writefds, fd_set *exceptfds, const struct timespec *timeout, const sigset_t *sigmask);` - функция ожидает событий ввода/вывода, но позволяет указать маску сигналов для блокирования во время ожидания. Это может быть полезно, чтобы избежать прерывания ожидания сигналами и гарантировать безопасность.

Она также позволяет установить время ожидания, после которого функция завершит выполнение, даже если нет доступных событий.

- `nfds`: Это наибольший номер файлового дескриптора (file descriptor), который будет использоваться в множестве дескрипторов `readfds`, `writefds`, и `exceptfds`, плюс 1. Это нужно для оптимизации работы функции и указывает на количество дескрипторов, которые вы хотите отслеживать.
- `readfds`: Указатель на множество дескрипторов, которые вы хотите отслеживать для операций ввода (чтение).
- `writefds`: Указатель на множество дескрипторов, которые вы хотите отслеживать для операций вывода (запись).
- `exceptfds`: Указатель на множество дескрипторов, которые вы хотите отслеживать для обнаружения исключительных ситуаций.
- `timeout`: Указатель на структуру `timespec`, которая определяет время ожидания. Функция будет блокирована до появления события или истечения этого времени. Если `timeout` установлен в `NULL`, то функция будет ждать бесконечно.
- `sigmask`: Указатель на набор сигналов, которые будут заблокированы во время ожидания. Если `sigmask` установлен в `NULL`, сигналы не будут блокированы.

Значение, возвращаемое функцией `pselect()`, будет количество готовых к вводу/выводу файловых дескрипторов, или -1 в случае ошибки

